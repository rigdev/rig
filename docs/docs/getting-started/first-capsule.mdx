# Deploy your First Capsule

Now that you have a configured Rig platform up and running, and you have installed the CLI, you are ready to deploy your first capsule. 
This will be a short introruction on how to deploy a containerized application to Rig using the CLI. 
Please refer to the [Capsules Page](../../platform/capsules), if you wish to dive deeper into the concept of capsules and how to interact with them in the dashboard.

## Deploy Nginx in a Rig Capsule Using the CLI

This guide will take you through the process of deploying an Nginx Server to Rig using the CLI.

### Create a capsule

```bash
rig capsule create nginx-capsule
```

This will create an empty capsule called `nginx-capsule` with no additional resources. We can verify that the capsule was created by running:

### Add and deploy an image

Next, we need to add and deploy the Nginx image to the capsule. This is done using the following command:

```bash
rig deploy nginx-capsule --image nginx:latest
```

Note that if you are on an arm chip, you should the arm version of the image, 'arm64v8/nginx:latest'.

This will add the nginx image to the capsule, and immediately deploy it in a rollout, for which we can follow the progress in the terminal.

If you wish to add images without deploying them making them available for future use, you can use the following command:

```bash
rig capsule image add nginx-capsule --image nginx:latest
```

This will simply save a reference of the image digest in the capsule.

If you wish to dive deeper in the the status of the capsule, you can run:

```bash
rig capsule status nginx-capsule -v
```

which will give you a detailed overview of the capsule and all its running resources.

### Scale the capsule

Now that we have a running capsule, we can scale for example scaling the number of replicas. This is also done using the deploy command:

```bash
rig deploy nginx-capsule --replicas 3
```

This will create a new rollout with the updated number of replicas. In order to verify this, you can run the previous commands to see the new changes reflected in the capsule status.

### Set Static Content
Instead of the default content, we can mount a config file in the capsule. This is done by creating an `index.html` file with some content, for example:

```html
<html>
  <body>
    <h1>Hello World!</h1>
  </body>
</html>
```

and then running the following command:
```bash
rig deploy nginx-capsule --set-config-file path=/usr/share/nginx/html/index.html,src=index.html
```
where path is the path in the container and src is the path to the file on your local machine.

### Configure the network

In order for the Nginx server to receive traffic, we need to configure the network. This is done by creating a `network.yaml` file, for example with the following content:

```yaml
name: http
port: 80
```

and then running the following command:

```bash
rig deploy nginx-capsule --set-network-interface network.yaml
```

This will create a new rollout with the updated network configuration.

### Access the Nginx server

Now, the capsule nginx server can only receive traffic from inside the cluster. We can however easily port-forward also using the rig-cli:

```bash
rig capsule port-forward nginx-capsule 8080:http
```


Now open your favorite browser and navigate to [http://localhost:8080](http://localhost:8080) to see the Nginx server running. Well done, you have created, deployed and exposed your first capsule using Rig! ðŸŽ‰

## Shortcut

The above guide executed every step of the process in each command explicitly. All the flags, can however be combined, and if you deploy to a non-existing capsule,
the capsule will be created automatically. This means that the process above can be shortened to:

```bash
rig deploy nginx-capsule -i nginx -r 3 --set-network-interface network.yaml --set-config-file path=/usr/share/nginx/html/index.html,src=index.html
```

Which will create a new capsule, add the image, scale it to 3 replicas, set the network interface and mount the config file.

